-- Verification queries for {{ relationship.type }} relationships
{% set column_names = module.model.column_analysis | map(attribute='sql_column_name') | list %}
SELECT count(*) FROM cypher('{{ project_name }}', $
    MATCH ()-[r:{{ relationship.type }}]->()
    WHERE r.source_dataset = '{{ table_name }}'
    RETURN count(r)
$) as (count agtype);

-- Sample relationships
SELECT * FROM cypher('{{ project_name }}', $
    MATCH (s)-[r:{{ relationship.type }}]->(t)
    WHERE r.source_dataset = '{{ table_name }}'
    RETURN s.name as source, 
           type(r) as relationship, 
           t.name as target
           {% if 'year' in column_names %}, r.year as year{% endif %}
           {% if 'value' in column_names %}, r.value as value{% endif %}
           {% if 'unit' in column_names %}, r.unit as unit{% endif %}
    LIMIT 10
$) as (source agtype, relationship agtype, target agtype
    {% if 'year' in column_names %}, year agtype{% endif %}
    {% if 'value' in column_names %}, value agtype{% endif %}
    {% if 'unit' in column_names %}, unit agtype{% endif %});